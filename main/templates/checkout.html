{% extends 'base.html' %}
{% load static %}
{% block content %}
<main class="container my-4" id="cartList">
	<form method="POST">
		<div class="row">
			<div class="col-6 flex-column">
				<h4 class="my-4 text-left border-bottom pb-1">THÔNG TIN LIÊN HỆ</h4>
				<fieldset>
					<legend for="email">Email</legend>
					<input type="text" id="email">
				</fieldset>
				<fieldset>
					<legend for="mobile">Số điện thoại</legend>
					<input type="text" id="mobile">
				</fieldset>
				<h4 class="my-4 text-left border-bottom pb-1">THÔNG TIN NHẬN HÀNG</h4>
				<fieldset>
					<legend>Họ và tên (*)</legend>
					<input type="text" id="recipient">
				</fieldset>
				<div class="col-md-6 p-0">
					<fieldset>
						<legend for="province">Tỉnh/Thành phố (*)</legend>
						<select id="province">
							<option value="" selected style="font-style: italic; text-align: center;">-- Chọn --</option>
						</select>
					</fieldset>
					<fieldset>
						<legend>Quận/Huyện (*)</legend>
						<select id="district">
							<option value="" selected style="font-style: italic; text-align: center;">-- Chọn --</option>
						</select>
					</fieldset>
					<fieldset>
						<legend>Phường/Xã (*)</legend>
						<select id="ward">
							<option value="" selected style="font-style: italic; text-align: center;">-- Chọn --</option>
						</select>
					</fieldset>
					<fieldset>
						<legend>Số nhà/Đường (*)</legend>
						<input type="text">
					</fieldset>
				</div>
				<fieldset>
					<legend for="note">Ghi chú đơn hàng (nếu có)</legend>
					<input type="text" id="note">
				</fieldset>
				<div class="text-center mt-3">
					<button class="btn btn-danger">Quay lại trang thông tin giao hàng</button>
					<a class="btn btn-primary" href="{% url 'shipment' %}">Tiếp tục đến trang vận chuyển</a>
				</div>
			</div>
			<div class="col-6 flex-column">
				{% include "order_updated.html" %}
			</div>
		</div>
	</form>
</main>
<script type="text/javascript">
	// Gọi API để lấy dữ liệu tỉnh
	fetch('https://provinces.open-api.vn/api/p/')
		.then(response => response.json())
		.then(data => {
			const provinceSelect = document.getElementById('province');

			// Thêm các tùy chọn tỉnh vào dropdown
			data.forEach(province => {
				const option = document.createElement('option');
				option.value = province.code;
				option.text = province.name;
				provinceSelect.appendChild(option);
			});

			// Lắng nghe sự kiện khi tỉnh được chọn
			provinceSelect.addEventListener('change', function () {
				const selectedProvinceCode = this.value;

				// Xóa các tùy chọn huyện và xã hiện có
				document.getElementById('district').innerHTML = '<option value="">-- Chọn --</option>';
				document.getElementById('ward').innerHTML = '<option value="">-- Chọn --</option>';

				// Hiển thị danh sách huyện ngay khi tỉnh được chọn
				fetchDistrictData(selectedProvinceCode.code);
			});
		});

	function fetchDistrictData(provinceCode) {
		// Sử dụng liên kết API mặc định của 'https://provinces.open-api.vn'
		fetch('https://provinces.open-api.vn/api/d/')
			.then(response => response.json())
			.then(data => {
				const districtSelect = document.getElementById('district');

				// Lọc danh sách huyện dựa trên mã tỉnh
				const filteredDistricts = data.filter(district => district.parent_code === provinceCode);

				// Thêm các tùy chọn huyện vào dropdown
				filteredDistricts.forEach(district => {
					const option = document.createElement('option');
					option.value = district.code;
					option.text = district.name;
					districtSelect.appendChild(option);
				});

				// Lắng nghe sự kiện khi huyện được chọn
				districtSelect.addEventListener('change', function () {
					const selectedDistrictCode = this.value;

					// Xóa các tùy chọn xã hiện có
					document.getElementById('ward').innerHTML = '<option value="">Chọn xã</option>';

					// Hiển thị danh sách xã ngay khi huyện được chọn
					fetchWardData(selectedDistrictCode.code);
				});
			});
	}

	function fetchWardData(districtCode) {
		// Sử dụng liên kết API mặc định của 'https://provinces.open-api.vn'
		fetch('https://provinces.open-api.vn/api/w/')
			.then(response => response.json())
			.then(data => {
				const wardSelect = document.getElementById('ward');

				// Lọc danh sách xã dựa trên mã huyện
				const filteredWards = data.filter(ward => ward.parent_code === districtCode);

				// Thêm các tùy chọn xã vào dropdown
				filteredWards.forEach(ward => {
					const option = document.createElement('option');
					option.value = ward.code;
					option.text = ward.name;
					wardSelect.appendChild(option);
				});
			});
	}
</script>
{% endblock %}